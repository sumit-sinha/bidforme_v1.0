angular.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minuteStep:5,minView:"minute",startView:"day",weekStart:0}).directive("datetimepicker",["dateTimePickerConfig",function(e){"use strict";var t=function(e){var t=["startView","minView","minuteStep","dropdownSelector","weekStart"];for(var n in e){if(e.hasOwnProperty(n)){if(t.indexOf(n)<0){throw"invalid option: "+n}}}var r=["minute","hour","day","month","year"];if(r.indexOf(e.startView)<0){throw"invalid startView value: "+e.startView}if(r.indexOf(e.minView)<0){throw"invalid minView value: "+e.minView}if(r.indexOf(e.minView)>r.indexOf(e.startView)){throw"startView must be greater than minView"}if(!angular.isNumber(e.minuteStep)){throw"minuteStep must be numeric"}if(e.minuteStep<=0||e.minuteStep>=60){throw"minuteStep must be greater than zero and less than 60"}if(e.dropdownSelector!==null&&!angular.isString(e.dropdownSelector)){throw"dropdownSelector must be a string"}if(!angular.isNumber(e.weekStart)){throw"weekStart must be numeric"}if(e.weekStart<0||e.weekStart>6){throw"weekStart must be greater than or equal to zero and less than 7"}};return{restrict:"E",require:"ngModel",template:"<div class='datetimepicker'>"+"<table class='table-condensed'>"+"   <thead>"+"       <tr>"+"           <th class='left'"+"               data-ng-click='changeView(data.currentView, data.leftDate, $event)'"+"               ><i class='glyphicon glyphicon-arrow-left'/></th>"+"           <th class='switch' colspan='5'"+"               data-ng-click='changeView(data.previousView, data.currentDate, $event)'"+">{{ data.title }}</th>"+"           <th class='right'"+"               data-ng-click='changeView(data.currentView, data.rightDate, $event)'"+"             ><i class='glyphicon glyphicon-arrow-right'/></th>"+"       </tr>"+"       <tr>"+"           <th class='dow' data-ng-repeat='day in data.dayNames' >{{ day }}</th>"+"       </tr>"+"   </thead>"+"   <tbody>"+"       <tr data-ng-class='{ hide: data.currentView == \"day\" }' >"+"           <td colspan='7' >"+"              <span    class='{{ data.currentView }}' "+"                       data-ng-repeat='dateValue in data.dates'  "+"                       data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}' "+'                       data-ng-click="changeView(data.nextView, dateValue.date, $event)">{{ dateValue.display }}</span> '+"           </td>"+"       </tr>"+"       <tr data-ng-show='data.currentView == \"day\"' data-ng-repeat='week in data.weeks'>"+"           <td data-ng-repeat='dateValue in week.dates' "+"               data-ng-click='changeView(data.nextView, dateValue.date, $event)'"+"               class='day' "+"               data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}' >{{ dateValue.display }}</td>"+"       </tr>"+"   </tbody>"+"</table></div>",scope:{ngModel:"=",onSetTime:"="},replace:true,link:function(n,r,i){var s={};if(i.datetimepickerConfig){s=n.$eval(i.datetimepickerConfig)}var o={};angular.extend(o,e,s);t(o);var u={year:function(e){var t=moment.utc(e).startOf("year");var r=parseInt(t.year()/10,10)*10;var i=moment.utc(t).year(r-1).startOf("year");var s=n.ngModel?moment(n.ngModel).year():0;var u={currentView:"year",nextView:o.minView==="year"?"setTime":"month",title:r+"-"+(r+9),leftDate:moment.utc(i).subtract(9,"year").valueOf(),rightDate:moment.utc(i).add(11,"year").valueOf(),dates:[]};for(var a=0;a<12;a++){var f=moment.utc(i).add(a,"years");var l={date:f.valueOf(),display:f.format("YYYY"),past:f.year()<r,future:f.year()>r+9,active:f.year()===s};u.dates.push(l)}return u},month:function(e){var t=moment.utc(e).startOf("year");var r=n.ngModel?moment(n.ngModel).format("YYYY-MMM"):0;var i={previousView:"year",currentView:"month",nextView:o.minView==="month"?"setTime":"day",currentDate:t.valueOf(),title:t.format("YYYY"),leftDate:moment.utc(t).subtract(1,"year").valueOf(),rightDate:moment.utc(t).add(1,"year").valueOf(),dates:[]};for(var s=0;s<12;s++){var u=moment.utc(t).add(s,"months");var a={date:u.valueOf(),display:u.format("MMM"),active:u.format("YYYY-MMM")===r};i.dates.push(a)}return i},day:function(e){var t=moment.utc(e);var r=moment.utc(t).startOf("month");var i=moment.utc(t).endOf("month");var s=moment.utc(r).subtract(Math.abs(r.weekday()-o.weekStart),"days");var u=n.ngModel?moment(n.ngModel).format("YYYY-MMM-DD"):"";var a={previousView:"month",currentView:"day",nextView:o.minView==="day"?"setTime":"hour",currentDate:t.valueOf(),title:t.format("YYYY-MMM"),leftDate:moment.utc(r).subtract(1,"months").valueOf(),rightDate:moment.utc(r).add(1,"months").valueOf(),dayNames:[],weeks:[]};for(var f=o.weekStart;f<o.weekStart+7;f++){a.dayNames.push(moment.utc().weekday(f).format("dd"))}for(var l=0;l<6;l++){var c={dates:[]};for(var h=0;h<7;h++){var p=moment.utc(s).add(l*7+h,"days");var d={date:p.valueOf(),display:p.format("D"),active:p.format("YYYY-MMM-DD")===u,past:p.isBefore(r),future:p.isAfter(i)};c.dates.push(d)}a.weeks.push(c)}return a},hour:function(e){var t=moment.utc(e).hour(0).minute(0).second(0);var r=n.ngModel?moment(n.ngModel).format("YYYY-MM-DD H"):"";var i={previousView:"day",currentView:"hour",nextView:o.minView==="hour"?"setTime":"minute",currentDate:t.valueOf(),title:t.format("YYYY-MMM-DD"),leftDate:moment.utc(t).subtract(1,"days").valueOf(),rightDate:moment.utc(t).add(1,"days").valueOf(),dates:[]};for(var s=0;s<24;s++){var u=moment.utc(t).add(s,"hours");var a={date:u.valueOf(),display:u.format("H:00"),active:u.format("YYYY-MM-DD H")===r};i.dates.push(a)}return i},minute:function(e){var t=moment.utc(e).minute(0).second(0);var r=n.ngModel?moment(n.ngModel).format("YYYY-MM-DD H:mm"):"";var i={previousView:"hour",currentView:"minute",nextView:"setTime",currentDate:t.valueOf(),title:t.format("YYYY-MMM-DD H:mm"),leftDate:moment.utc(t).subtract(1,"hours").valueOf(),rightDate:moment.utc(t).add(1,"hours").valueOf(),dates:[]};var s=60/o.minuteStep;for(var u=0;u<s;u++){var a=moment.utc(t).add(u*o.minuteStep,"minute");var f={date:a.valueOf(),display:a.format("H:mm"),active:a.format("YYYY-MM-DD H:mm")===r};i.dates.push(f)}return i},setTime:function(e){var t=new Date(e);var r=new Date(t.getTime()+t.getTimezoneOffset()*6e4);if(o.dropdownSelector){jQuery(o.dropdownSelector).dropdown("toggle")}if(angular.isFunction(n.onSetTime)){n.onSetTime(r,n.ngModel)}n.ngModel=r;return u[n.data.currentView](e)}};var a=function(){var e=n.ngModel?moment(n.ngModel).toDate():new Date;return e.getTime()-e.getTimezoneOffset()*6e4};n.changeView=function(e,t,r){if(r){r.stopPropagation();r.preventDefault()}if(e&&t>-Infinity&&u[e]){n.data=u[e](t)}};n.changeView(o.startView,a());n.$watch("ngModel",function(){n.changeView(n.data.currentView,a())})}}}])